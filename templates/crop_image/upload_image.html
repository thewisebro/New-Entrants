{% extends "base.html" %}

{% block styles %}
  {% if crop %}
    <link rel="stylesheet" href="{{STATIC_URL}}jquery/jcrop/jquery.Jcrop.min.css" type="text/css" />
  {% endif %}
  <link rel="stylesheet" href="{{STATIC_URL}}css/crop_image/style.css" type="text/css" />
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script src="{{STATIC_URL}}jquery/jquery-migrate.min.js" type="text/javascript"></script>
  <script src="{{STATIC_URL}}js/crop_image/crop_image.js" type="text/javascript"></script>
  {% if crop %}
    <script src="{{STATIC_URL}}jquery/jcrop/jquery.Jcrop.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      var image_url = '{{ image_url }}';
      var crop_image_width = {{ cropimageclass.width }};
      var crop_image_height = {{cropimageclass.height }};
      {% if cropping_done %}
        parent.cropping_done(image_url);
      {% else %}
        setup_jcrop();
      {% endif %}
    </script>
  {% else %}
    <script type='text/javascript'>
      $('#id_photo').change(function(){
        setTimeout(function(){
          $('#submit-photo').click();
        },1);
      });
      if($.browser.mozilla) {
        $('#button').click(function() {
          $('#id_photo').click();
        });
      }
      if($.browser.msie)
        $('input[name=is_ie]').val(1);
    </script>
  {% endif %}
{% endblock %}

{% block body %}
  <div id='left-div'>
  {% if not crop %}
    <img src="{{ image_url }}" width="{{ cropimageclass.width }}px" height="{{ cropimageclass.height }}px" id="preview" />
  {% else %}
    <div style="float:right;width:{{ cropimageclass.width }}px;height:{{ cropimageclass.height }}px;overflow:hidden;">
      <img src="{{ image_url }}" id="preview"/>
    </div>
  {% endif %}
  <div style="clear:both"></div>
    <form id='photo-form' name='photo_form' method="POST" action="" enctype="multipart/form-data">{% csrf_token %}
  {% if not crop %}
      <input type='file' style="display:block;position:fixed;top:-100px" name='{{ photoform.photo.name }}' id='{{ photoform.photo.auto_id }}'/>
      <!-- Above styling is given because file uploading doesn't work in some browsers if visibility is hidden or display is none -->
      <label class='div-button' id="button" style="padding:6px 8px;" for="id_photo">Upload</label>
      <input type="hidden" name="is_ie" value="0"/><!-- Internet Explorer -->
      <input type="submit" id='submit-photo' name="upload" value="Submit" style="display:none" />
    </form>
  </div>
  {% else %}
      <input type="hidden" id='x' name='x'/>
      <input type="hidden" id='y' name='y'/>
      <input type="hidden" id='w' name='w'/>
      <input type="hidden" id='h' name='h'/>
      <input class='input-button' type="submit" name="cropdone" value ="Done Cropping"/>
    </form>
  </div>
  <div id='right-div'>
    <span>Crop image</span><br>
    <img src="{{ image_url }}" width="400px" height="auto" id="target"/>
  </div>
  {% endif %}
{% endblock %}
