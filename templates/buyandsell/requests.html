{% extends "buyandsell/base.html" %}
{% block header %}
<body style="overflow-y: scroll;">
<div class="headerBackground">
  <header class="header container header-container">

    <div class="header-logo-div">
      <a href="/buyandsell/buy">
        <img src="{{STATIC_URL}}images/buyandsell/logo.png" class="header-logo-image">

      </a>
    </div>
    <!--Search box HTML starts here-->

    <div class="search-area">
      <form action="#" id="search_form">
        <input class="search-form" type="search" maxlength="50" name="keyword"
               placeholder="What are you looking for... " autocomplete="off">
        <img class="search-icon" src="{{STATIC_URL}}images/buyandsell/search-icon.png">

        <div class="search-result-box">

        </div>
      </form>
    </div>

    <!--
    <div class="browse-button-div">
      <div class="dropdown" style="display:inline">
        <button type="button" class="btn dropdown-toggle global-browse" id="menu2" data-toggle="dropdown">
          Browse

        </button>
        <ul class="dropdown-menu used-dropdown-menu" style="margin-top:42%; margin-left:-188%;" role="menu"
            aria-labelledby="menu2">
          <div class="arrow-up-behind" style="margin-left:69.5%; margin-top:-11.5%"></div>
          <div class="arrow-up-front" style="margin-left:70.5%; margin-top:-10.5%"></div>

          <li role="presentation"><a role="menuitem" tabindex="-1" href="/buyandsell/viewrequests">Latest</a></li>

          {% for key,value in cat_dict.iteritems %}
          <li role="presentation" class="dropdown-submenu">
            <a role="menuitem" tabindex="-1" href="/buyandsell/viewrequests/{{key}}">{{ key }}</a>
            <ul class="dropdown-menu used-dropdown-menu" role="menu" aria-labelledby="menu2">
              {% for row in value %}
              <li role="presentation"><a role="menuitem" tabindex="-1"
                                         href="/buyandsell/viewrequests/{{row.main_category}}/{{row.code}}">{{row.name}}</a>
              </li>
              {% endfor %}
            </ul>
            {% endfor %}
          </li>
        </ul>
      </div>
    </div>
    -->

    {% if login_flag %}

    <div class="dropdown" style=" display:inline; float: right; margin-right: -15px;">
      <button class="btn btn-default dropdown-toggle user-photo-button user-photo-circle-converter" type="button"
              id="menu1" data-toggle="dropdown">
        <img src="{{ user.photo_url }}" class="user-photo">
        <span class="caret user-photo-caret"></span>
      </button>
      <ul class="dropdown-menu header-user-photo-dropdown-menu" role="menu" aria-labelledby="menu1">
        <div class="arrow-up-behind" style="margin-left:81.5%; margin-top:-11.5%"></div>
        <div class="arrow-up-front" style="margin-left:82%; margin-top:-10.5%"></div>
        <li role="presentation"><a role="menuitem" tabindex="-1" href="/buyandsell/my-account">My Account</a></li>
        <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Channel- i</a></li>
        <li role="presentation"><a role="menuitem" tabindex="-1" onclick="logout(from_buyandsell = true)">Logout</a>
        </li>
      </ul>
    </div>
    <button type="button" onclick= "request_form()" class="btn global-button header-request-button">
      Request
    </button>
    <button type="button" onclick = "sell_form()" class="btn global-button header-sell-button">
      Sell
    </button>


    {% else %}

    <div id="header-options">
      <div class="sign-in-button" onclick="open_login_dialog(from_buyandsell=true)">Sign In</div>
    </div>
    <!--
    <div class="sign-in-request-text">
      Sign in to have a better experience
    </div>
    -->


    {% endif %}

  </header>
</div>
{% endblock %}


{% block content %}
<div class="container"  style="min-width: 765px;">
  {% if messages %}
  {% for message in messages %}
  <div class="alert alert-{{ message.tags }}">{{ message }} </div>
  {% endfor %}
  {% endif %}
  <div class="row sub-header">
    <div class="col-md-3">
    </div>
    <div>
      <ol class="breadcrumb">
        <li>
          <a class="active" href="/buyandsell/viewrequests">Home</a>
        </li>
        {% if not mc and not category  and not search_flag %}
        <li>
          <a class="active" href="/buyandsell/viewrequests">Latest</a>
        </li>
        {% endif %}
        {% if mc and not category  %}
        <li>
          <a class="active" href="/buyandsell/viewrequests/{{mc}}">{{mc}}</a>
        </li>
        {% endif %}
        {% if mc and category %}
        <li>
          <a  href="/buyandsell/viewrequests/{{mc}}">{{mc}}</a>
        </li>
        <li>
          <a class="active" href="/buyandsell/viewrequests/{{mc}}/{{c}}">{{ category}}</a>
        </li>
        {% endif %}

        {% if  search_flag %}
        <li>
          <a class="active">Searched</a>
        </li>
        <li>
          <a class="active">{{search_string}}</a>
        </li>
        {% endif %}
      </ol>
    </div>
  </div>
  {% if login_flag %}
  <a class="watch-button-anchor">
    {% if mc and not category %}
    {% if mc in main_watched %}
    <button type="button"  id="watch_btn"  class="btn global-button watch-button watch-button-watching" onclick='watch_new("{{mc}}","{{c}}" )'>
      Watching
    </button>
    {% else %}
    <button type="button" id="watch_btn" class="btn global-button watch-button" onclick='watch_new("{{mc}}","{{c}}" )'>
      Watch this category
    </button>
    {% endif %}
    {% endif %}

    {% if mc and  category %}
    {% if category in sub_watched %}
    <button type="button" id="watch_btn" class="btn global-button watch-button watch-button-watching" onclick='watch_new("{{mc}}","{{c}}" )'>
      Watching
    </button>
    {% else %}
    <button type="button" id="watch_btn" class="btn global-button watch-button" onclick='watch_new("{{mc}}","{{c}}" )'>
      Watch this category
    </button>
    {% endif %}
    {% endif %}

    {% if not mc and not category %}
    {% endif %}

  </a>
  {% endif %}
  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <div class="division-line">
      </div>
    </div>
  </div>
  {% block leftbox %}
  <div class="row">
    <div>
      <div class="left-box">
        <div class="row">
          <div class="col-md-12">
            <form action="" class="input-group-addon view-what" style="padding: 0;">
              <div class="left-box-main-link-div">
                {% if search_flag %}
                <a href="/buyandsell/see_all/sell/?{% if queries %}{{queries.urlencode}}{% endif %}" class="left-box-main-link-dormant">
                  <span>
                    Items for Sale
                  </span>
                </a>
                {% else %}
                <a href="/buyandsell/buy{% if mc %}/{{mc}}{% endif %}{% if c %}/{{c}}{% endif %}" class="left-box-main-link-dormant">
                  <span>
                    Items for Sale
                  </span>
                </a>
                {% endif %}
              </div>

              <div class="left-box-main-link-div">
                {% if search_flag %}
                <a href="/buyandsell/see_all/requests/?{% if queries %}{{queries.urlencode}}{% endif %}" class="left-box-main-link-active">
                  <span>
                    Requests
                  </span>
                </a>
                {% else %}
                <a href="/buyandsell/viewrequests{% if mc %}/{{mc}}{% endif %}{% if c %}/{{c}}{% endif %}" class="left-box-main-link-active">
                  <span>
                    Requests
                  </span>
                </a>
                {% endif %}
              </div>
            </form>
            <div class="left-division-line">
            </div>
          </div>
          {% if not search_flag %}
          <div class="col-md-12">
            <p class="filter-by-category-heading">Filter by Category</p>
            <div class="dropdown" id="filter-by-category">
              <div class="active-category dropdown-toggle" data-toggle="dropdown" id="category-filter">
                <img class="dropdown-arrow" src="{{STATIC_URL}}images/buyandsell/dropdown-arrow.png">
                <ul class="active-category-text">
                  {% if not mc and not category  and not search_flag %}
                  <li>
                    <a class="active" href="/buyandsell/viewrequests">Latest</a>
                  </li>
                  {% endif %}
                  {% if mc and not category  %}
                  <li>
                    <a class="active" href="/buyandsell/viewrequests/{{mc}}">{{mc}}</a>
                  </li>
                  {% endif %}
                  {% if mc and category %}
                  <li>
                    <a  href="/buyandsell/viewrequests/{{mc}}">{{mc}}</a>
                  </li>
                  {% endif %}
                </ul>
              </div>
              <ul class="dropdown-menu used-dropdown-menu" style="margin-top: 0;margin-left: 30px;border-top-left-radius: 0;border-top-right-radius: 0;min-width: 199px; "  role="menu" aria-labelledby="category-filter">
                <li role="presentation"><a role="menuitem" tabindex="-1" href="/buyandsell/viewrequests">Latest</a></li>

                {% for key,value in cat_dict.iteritems %}
                <li role="presentation" class="dropdown-submenu">
                  <a role="menuitem" tabindex="-1" href="/buyandsell/viewrequests/{{key}}">{{ key }}</a>
                  <ul class="dropdown-menu used-dropdown-menu" role="menu" aria-labelledby="menu2">
                    {% for row in value %}
                    <li role="presentation"><a role="menuitem" tabindex="-1"
                                               href="/buyandsell/viewrequests/{{row.main_category}}/{{row.code}}">{{row.name}}</a>
                    </li>
                    {% endfor %}
                  </ul>
                  {% endfor %}
                </li>
              </ul>
            </div>

            <ul class="left-box-sub-category-list">
              {% for key,value in cat_dict.items %}
              {% if key == mc  %}

              {% for sub_cat in value %}


              {% if category == sub_cat.name %}
              <li class="left-box-sub-category left-box-sub-category-active">
                <a href="/buyandsell/viewrequests/{{mc}}/{{sub_cat.code}}">{{sub_cat.name}}</a>
              </li>

              {% else %}
              <li class="left-box-sub-category">
                <a href="/buyandsell/viewrequests/{{mc}}/{{sub_cat.code}}">{{sub_cat.name}}</a>
              </li>
              {% endif %}

              {% endfor %}

              {% endif %}
              {% endfor %}
            </ul>

            <div class="left-division-line">
            </div>
          </div>
          {% endif %}

        </div>

        <div class="row price-filter">
          <div class="col-md-12">
            <p>Price Range</p>

            <form action="" class="input-group-addon view-what" method="get">
              <div class="price-line">
                <div class="slider-back"></div>
                <div id="slider-range"></div>
                <div class="prices" style="margin-top:20px;">
                  {% if ll and ul %}
                  <script>

                    $( "#slider-range" ).slider
                    ({
                      range: true,
                      min: 0,
                      max: 50000,
                      values:[{{ll}},{{ul}}],
                    slide: function( event, ui )
                    {
                      $( "#low" ).val(ui.values[ 0 ]);
                      $( "#high" ).val(ui.values[ 1 ] );
                    }
                    });
                  </script>
                  {% endif %}
                  <div class="price-range-text-input-group">
                    <img class="rupee-icon input-box-rupee-icon-min" src="{{STATIC_URL}}images/buyandsell/rupee-icon-with-white-bg.png">
                    <img class="rupee-icon input-box-rupee-icon-max" src="{{STATIC_URL}}images/buyandsell/rupee-icon-with-white-bg.png">
                    <input type="hidden" name="keyword" value="{% if search_string %}{{search_string}}{% endif %}">
                    <input type="text" id="low" class="price-range-text-input" value="{% if ll %}{{ll}}{% endif %}" name="ll">
                    <input type="text" id="high" class="price-range-text-input" value="{% if ul %}{{ul}}{% endif %}" name="ul">
                  </div>
                  <button class="global-browse price-range-submit">
                    <img class="price-range-submit-button-image"
                         src="{{STATIC_URL}}images/buyandsell/price-range-submit-button-image.png">
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    {% endblock %}
    <div class="page-content">
      {% if table_data %}
      <table class="table table-striped">
        <thead>
        <tr>
          <th>Item</th>
          <th>Max Price (  <img class="rupee-icon" src="{{STATIC_URL}}images/buyandsell/rupee-icon.png">  )</th>
          <th>Expires in</th>
        </tr>
        </thead>
        <tbody>
        {% for row in table_data %}
        <tr onclick="request_details({{ row.pk }},'{{row.item_name}}')" class="request">
          <td class="requested-item-name">{{row.item_name}}</td>
          <td class="requested-item-price">{{row.price_upper}}</td>
          <td>{{ row.expiry_date|timeuntil }}</td>
        </tr>
        {% endfor %}
        </tbody>
      </table>
      {% endif %}

      {% if not table_data %}
      <p class="nothing-in-this-category">No requests to show</p>
      {% endif %}

      {% if paginator %}
      {% block paginator %}
      <nav>
        <ul class="pagination pagination-customized">

          {% if table_data.number != 1 %}
          <li>
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page=1" aria-label="Previous">
              <span aria-hidden="true">First</span>
            </a>
          </li>
          {% endif %}

          {% if table_data.has_previous %}
          <li>
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page={{ table_data.previous_page_number }}"
               aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          {% endif %}

          {% for page in page_list %}
          {% if table_data.number == page %}
          <li class="active">
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page={{ table_data.number }}">{{table_data.number}}
            </a>
          </li>
          {% else %}
          <li>
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page={{ page }}">{{ page }}
            </a>
          </li>
          {% endif %}
          {% endfor %}

          {% if table_data.has_next %}
          <li>
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page={{ table_data.next_page_number }}"
               aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
          {% endif %}

          {% if table_data.number != table_data.paginator.num_pages %}
          <li>
            <a href="?{% if queries %}{{queries.urlencode}}&amp;{% endif %}page={{ paginator.num_pages }}"
               aria-label="Next">
              <span aria-hidden="true">last</span>
            </a>
          </li>
          {% endif %}

        </ul>
      </nav>
      {% endblock %}
      {% endif %}

    </div>

  </div>

</div>
{% endblock %}







