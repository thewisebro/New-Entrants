<html>
  <head>
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/genforms/bootstrap.css"/>
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/nucleus/style.css" type="text/css">
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/utilities/edit_profile.css"/>
  <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/genforms/base.css"/>
{{ form.media.css }}
  <link href="/static/jquery/custom.css" type="text/css" media="all" rel="stylesheet">
  <title>Smart Card Registration</title>
  </head>
  <body>

    {% load kwacros %}
    {% kwacro noneditable_field_div label value id name1 %}
      <div class="edit-line">
        <label class="field-label-big" for="{{ id }}">{{ label }}</label>
        <div class="field"><input class="readonly-input" {% ifnotequal name1 "" %}name="{{ name1 }}"{% endifnotequal %} type="text" {% if name1 and not error %} value="{{ value|date:"d-m-Y" }}" {% else %} value="{{ value }}" {% endif %}readonly="readonly" id="{{ id }}"/></div>
      </div>
    {% endkwacro %}

    {% kwacro editable_field_div field %}
      <div class="edit-line">
        <label class="field-label-big" for="{{ field.auto_id }}">
          {{field.label}}
        </label>
        <div class="field ">
        {% if field.label == "Birth date"%}
           {% if not error %}
           <input type="text" name="birth_date" id="id_birth_date" placeholder="DD-MM-YYYY" value="{{ field.value|date:"d-m-Y" }}">
           {% else %}
           <input type="text" name="birth_date" id="id_birth_date" placeholder="DD-MM-YYYY" value="{{ field.value }}">
           {% endif %}
        {% else %}
          {% if field.label == "Valid till"%}
             {% if not error %}
             <input type="text" name="valid_till" id="id_valid_till" placeholder="DD-MM-YYYY" value="{{ field.value|date:"d-m-Y" }}">
             {% else %}
             <input type="text" name="valid_till" id="id_valid_till" placeholder="DD-MM-YYYY" value="{{ field.value }}">
             {% endif %}
          {% else %}
             {{field}}
          {% endif %}
        {% endif %}
        </div>
        {% if field.errors %}<span class="error">{{field.errors.as_text}}</span>{% endif %}
      </div>
    {% endkwacro %}
    <div id="parent">
      <div id="content">
          <div id="header">
            <div>
              <div id="iitr">
                <img id="logo" src="{{STATIC_URL}}images/genforms/iitr_logo.gif">
              </div>
                <span id="iitr_text">Indian Institute of Technology Roorkee</span>
            </div>
          <a id="logout" href="/logout/"><button class="btn">Logout</button></a>
          </div>
          <span id="heading">Smart Card Registration</span>
          <div id="upper-half">
            <div id="photo_div">
              {% if pic_instance.pic %}
              <img id="genform_pic-img" src="{{ pic_instance.pic.url }}" class="img-rounded">
              {% else %}
              <img id="genform_pic-img" src="{{STATIC_URL}}images/nucleus/default_dp.png" class="img-rounded">
              {% endif %}
            <div id="upload">
              <button type="button" class="input-button" onclick="upload_image('genform_pic',{{ pic_instance.pk }})">Upload Image</button>
            </div>
            </div>
            <div id="sign_div"></div><br>
          </div>
          <div style="clear:both"></div>
          <div id="lower-half">
          <div id="sign_fail"></div>
          {% if not first_time and not error%}
            <div id="first_time">You've been registered. In case you want to make changes, fill the form again.</div>
          {% endif %}
          {% usekwacro noneditable_field_div "Enrollment No" enrollment_no "id_enrollment_no" "" %}
          {% usekwacro noneditable_field_div "Name" name "id_name" "" %}
          {% usekwacro noneditable_field_div "Programme" programme "id_programme" "" %}
          {% usekwacro noneditable_field_div "Department" department "id_department" "" %}

          <form method="post" action="" onsubmit="return validate()">{% csrf_token %}
            {% for field in form %}
              {% ifnotequal field.label "Valid till" %}
                {% usekwacro editable_field_div field %}
              {% else %}
                {% if editable %}
                  {% usekwacro editable_field_div field %}
                {% else %}
                  {% usekwacro noneditable_field_div "Valid till" field.value "id_valid_till" "valid_till"%}
                {% endif %}
              {% endifnotequal %}
            {% endfor %}
            <div id="reason">
              <div id="reason-text">Why do you want to apply for a new smart card?</div>
              <input type="radio" name="reason" id="spelling" class="radio" value="Spelling mistake">
                  <label for="spelling">I made a spelling mistake</label>
              <input type="radio" name="reason" id="unreceived" class="radio" value="Did not receive my smart card">
                  <label for="unreceived">I did not receive my smart card</label>
              <input type="radio" name="reason" id="other-radio" class="radio" value="Other">
                  <label for="other-radio" id="other">Other : </label>
                <input type="text" name="other-reason-value" id="other-reason-value" onclick="$('#other-radio')[0].checked=true;">
              </button>
            </div>

            <input class='input-button' style='margin-left:20px' type="submit" name="save" value="Submit" />
              <div id="note">Note:</div>
              <div id="notes">
              <div>1. If any of the uneditable fields(Valid till, for example) are to be changed, please contact IMG.</div>
              <div>2. The specifications of your picture should be the same as those of an Indian Passport Photo.</div>
            </div>
          </form>
        </div>
        <div id="footer">
          <div id="footer-copyright">
               Â© 2014 <a href="http://img.channeli.in" target="_blank" title="Information Management Group">IMG, IIT Roorkee</a>
          </div>
          <div class="fb-like fb_iframe_widget" data-href="http://www.facebook.com/IMGIITRoorkee?ref=hl" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true" data-font="arial" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=&amp;font=arial&amp;href=http%3A%2F%2Fwww.facebook.com%2FIMGIITRoorkee%3Fref%3Dhl&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=true&amp;width=450"><span style="vertical-align: bottom; width: 79px; height: 20px;"><iframe name="f9ccbb358" width="450px" height="1000px" frameborder="0" allowtransparency="true" scrolling="no" title="fb:like Facebook Social Plugin" src="https://www.facebook.com/plugins/like.php?app_id=&amp;channel=https%3A%2F%2Fs-static.ak.facebook.com%2Fconnect%2Fxd_arbiter%2FFX-Xf5fQjUk.js%3Fversion%3D41%23cb%3Df2698d3118%26domain%3Dchanneli.in%26origin%3Dhttps%253A%252F%252Fchanneli.in%252Ff2d60ac8b%26relation%3Dparent.parent&amp;font=arial&amp;href=http%3A%2F%2Fwww.facebook.com%2FIMGIITRoorkee%3Fref%3Dhl&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=true&amp;width=450" class="" style="border: none; visibility: visible; width: 79px; height: 20px;"></iframe></span></div>
          <div id="footer-links">
             <a class="footer-link" href="/terms/" target="_blank">Terms of Use</a>
             <a class="footer-link" href="/" target="_blank" style="margin-left:0px">Channel i</a>
          </div>
        </div>
      </div>
    </div>
  <script type="text/javascript" src="/static/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/static/jquery/jquery-ui.min.js"></script>
  <script>
    d = new Date();
    timestamp = d.getTime();
    $("#sign_div")[0].innerHTML = '<img id="sign" src="https://channeli.in/acad/sign/?q=' + timestamp + ' class="img-rounded"><h3> Signature </h3>'
  </script>
  <script>
    function validate()
    {
      if($("#other-radio")[0].checked === true && $("#other-reason-value")[0].value === "")
      {
        alert("Enter the reason you're applying for the smart card.");
        return false;
      }
      else
        return true;
    }
    window.onload = function() {
    if($("#sign")[0].naturalWidth==0)
    {
      $("#sign_fail")[0].innerHTML="Your signature could not be loaded. Please try clearing your cache by pressing Ctrl+f5. If it's still not loading, please contact the Academic Section and then fill this form."
      $(".input-button")[1].style.display = "none";
    }
    var temp = "{{radio_id}}";
    $(temp)[0].checked=true;
    console.log("{{other_radio_value}}")
    console.log(temp)
    if(temp == "#other-radio")
      $('[name="other-reason-value"]')[0].value="{{other_radio_value}}";
    };
  </script>
  <script type="text/javascript" src="/static/js/common.js"></script>
  <script type="text/javascript" src="/static/js/crop_image/crop_image.js"></script>
  {{ form.media.js }}
  </body>
</html>
