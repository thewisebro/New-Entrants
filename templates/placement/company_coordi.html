<!DOCTYPE HTML>
{% extends "placement/nucleus/base_old.html" %}
{% load kwacros %}
{% block title %}
      Company Coordinator
{% endblock %}
{% block styles %}
    <link rel="stylesheet" href="{{ STATIC_URL }}bootstrap/css/bootstrap.css" type="text/css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/placement/base.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/placement/input_styles.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}jquery/smoothness/jquery-ui.min.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/placement/dataTables.bootstrap.css" type="text/css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/placement/jquery.dataTables.css" type="text/css">
    <link rel="stylesheet" href="{{ STATIC_URL }}css/placement/placement.manager.css" type="text/css">
    <link rel="stylesheet" href="{{ STATIC_URL }}jquery/custom.css">
{% endblock %}
{% block body %}
    {% if not user_id %}
    <div class="content">
      <div class="header">
        <div class="tittle">
          <h2 >Company Coordinator</h2>
        </div>
        <div class="links">
          <div class="sub-links">
            <a href="/" target="_blank">Channel-i</a>
          </div>
          <div class="sub-links">
            <a href="/placement/" target="_blank">Placement Online</a>
          </div>
          <div class="sub-links">
            <a href="/logout">Logout</a>
          </div>
        </div>
      </div>
      <div class="exporter">
      <form class="form" enctype="multipart/form-data" method="post" action="{% url 'placement.views_img.contact_person_data_export' %}">
        {% csrf_token %}
        <input type=Hidden name='PM' value='0'>
        <button class="btn btn-primary" type="submit">Export</button>
      </form>
      </div>
      {% if not today %}
      <div class="right-div">
        <h4>
          <a href="{% url 'placement.views_img.company_coordinator_today_view' %}"
                   target="_blank">Contact(s) due today</a>
        </h4>
      </div>
      <div class="right-div">
        <h4>
          <a onclick=open_frame('Edit&nbsp;Company','{% url 'placement.views_img.add_company_manual' %}',800)>Enter company manually</a>
        </h4>
      </div>
      {% endif %}
      {% endif %}
      <div id="companies">
       {% if user_id %}
       <table id ="company" class="table table-striped table-bordered compact" style="table-layout: fixed;width:100%">
       {%else%}
       <table id ="company" class="table table-striped table-bordered compact">
       {% endif %}
          <thead>
            <tr>
              <th>Company Name</th>
              <th>Cluster</th>
              <th>Contact Person</th>
              <th>Designation</th>
              <th>Phone Number</th>
              <th>Email</th>
              <th>Status</th>
              <th>Last Contact</th>
              <th>Person in Contact</th>
              <th>Comments</th>
              <th>When to contact</th>
              <th>Edit Company</th>
              <th>Remove Company</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
{% endblock %}
{% block app_scripts %}
  <script type="text/javascript" src="{{ STATIC_URL }}js/jquery.min.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/placement/jquery.dataTables.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/placement/dataTables.bootstrap.js"></script>
  <script type="text/javascript" src="{{ STATIC_URL }}js/placement/dataTable.api.fnReloadAjax.js"></script>
  <script type="text/javascript">
    if (!String.prototype.format) {
      String.prototype.format = function() {
            var args = arguments;
            return this.replace(/{(\d+)}/g, function(match, number) { 
               return typeof args[number] != 'undefined'
                                  ? args[number]
                                  : match
                           ;
                    });
                  };
    }

    $(document).ready( function() {
        $('#company').DataTable( {
          "ajax": {
            {% if today %}
            "url":'/placement/company_coordinator/contactperson_data/today/',
            {% elif user_id %}
            "url":'/placement/company_coordinator/contactperson_data/{{user_id}}/',
            {% else %}
            "url":'/placement/company_coordinator/contactperson_data/',
            {% endif %}
           },
           stateSave: true,
           "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
              {% if today %}
              $('td:eq(0)', nRow).html("<a style='cursor:pointer;' onclick=open_frame('Details','/placement/contact_manager/details/{0}',800,false)>{1}</a>".format(aData[11],aData[0]));
              $('td:eq(5)', nRow).html("<div style='width:50px;height:40px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;'>{0}</div>".format(aData[5]));
              $('td:eq(6)', nRow).html("<div style='width:100px;height:40px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;'>{0}</div>".format(aData[6]));
              $('td:eq(9)', nRow).html("<div style='width:160px;height:40px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;'><a style='cursor:pointer;' onclick=open_frame('Comments','/placement/contact_manager/edit/comments/{0}',800,true)><span>{1}</span></a></div>".format(aData[11],aData[9]));
              $('td:eq(11)', nRow).html( " <div class='glyphs'>\
                                           <div class='glyph'>\
                                           <a onclick=open_frame('Edit&nbsp;Company','/placement/contact_manager/edit/{0}/',800,true)>\
                                           <span class='icon icon-pencil' style='cursor:pointer;' id='edit'></span></a>\
                                           </div>".format(aData[11]));
              $('td:eq(12)', nRow).html("  <div class='glyph'>\
                                           <a><span class='icon icon-remove' id='remove' style='cursor:pointer;' onclick='confirmfn({0})'></span></a>\
                                           </div>\
                                           </div>".format(aData[12]));
              {% else %}

              $('td:eq(0)', nRow).html("<a style='cursor:pointer;' onclick=open_frame('Details','/placement/contact_manager/details/{0}',800,false)>{1}</a>".format(aData[13],aData[0]));
              $('td:eq(5)', nRow).html("<div style='height:40px;overflow:hidden;text-overflow:ellipsis;'>{0}</div>".format(aData[5]));
              $('td:eq(6)', nRow).html("<div style='width:100px;height:40px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;'>{0}</div>".format(aData[6]));
              $('td:eq(9)', nRow).html("<div style='width:160px;height:40px;overflow:hidden;text-overflow:ellipsis;'><a style='cursor:pointer;' onclick=open_frame('Comments','/placement/contact_manager/edit/comments/{0}',800,true)><span>{1}</span></a></div>".format(aData[13],aData[9]));
              $('td:eq(11)', nRow).html( " <div class='glyphs'>\
                                           <div class='glyph'>\
                                           <a onclick=open_frame('Edit&nbsp;Company','/placement/contact_manager/edit/{0}/',800,true)>\
                                           <span style='cursor:pointer;' class='icon icon-pencil' id='edit'></span></a>\
                                           </div>".format(aData[11]));
              $('td:eq(12)', nRow).html("  <div class='glyph'>\
                                           <a><span class='icon icon-remove' id='remove' style='cursor:pointer;' onclick='confirmfn({0})'></span></a>\
                                           </div>\
                                           </div>".format(aData[12]));

              {% endif %}
           },
          }).columnFilter();
       });
</script>
<script>
function confirmfn(id){
  var a = confirm("Are you sure?");
  if (a==true){window.location='/placement/contact_manager/remove/{0}'.format(id)}
}
</script>
<script>
function autoResize(obj){
  var newheight;
  var newwidth;
  if(document.getElementById){
    newheight=obj.contentWindow.document.body.scrollHeight;
    newwidth=obj.contentWindow.document.body.scrollWidth;
  }
  obj.height=(newheight) + "px";
  obj.width=(newwidth) + "px"; 
}

function resizeIframe(obj) {
  obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
}

function dialog_iframe(data){
    var $dialog;
    try {
        $dialog = eval(data.name);
    }catch(e){}

    if(!$dialog){
      var height,margin;
      var related_window_height = $(window).height();
      related_window_height -= (1-data.height/related_window_height)*150;
      if(related_window_height > data.height){
        height = data.height;
        margin = (related_window_height-height)/2;
      }
      else{
        margin = 50;
        height = $(window).height()-2*margin;
      }
      $('body').append("<div id='"+data.name+"-div'></div>");
      dialog_options = {
        autoOpen: false,
        dialogClass: 'dialog-class',
        title: data.title,
        position: ['center',margin],
        width: data.width,
        height: height,
        draggable: false,
        resizable: false,
        sticky: true,
        close: function(event, ui){
          eval('delete '+data.name);
          $('#'+data.name+'-div').remove();
          },
        open: function(event, ui){
          $('#'+data.name+'-div').html(""+
            "<iframe id='"+data.name+"-iframe' src='"+data.src+
            "' width='"+(data.width-25)+"' height='"+(height-55)+"' frameborder=0></iframe>"
          );
        }
      };
      if('close' in data)
        dialog_options.beforeClose = data.close;
      $dialog = $('#'+data.name+'-div')
                .html('<p>Loading...</p>')
                .dialog(dialog_options);
    }
    $('.dialog-class').css({position:'fixed'});
    $dialog.dialog('open');
    eval(data.name+'=$dialog;');
    current_dialog = $dialog;
}

function open_frame(company_name,url,width,refresh){
  if(refresh){
    dialog_iframe({
    name: 'company_details_dialog',
    title: company_name,
    width: width,
    src: url,
    close: function(){
      $('#company').dataTable().fnReloadAjax(null,null,true);
      },
    });
  } else {
    dialog_iframe({
    name: 'company_details_dialog',
    title: company_name,
    width: width,
    src: url,
    });
  }
}

function close_dialog(dialog_name){
  eval(dialog_name).dialog('close');
  $('#company').DataTable().ajax.reload();
  current_dialog = null;
}
</script>
{% endblock %} {# Scripts #}
